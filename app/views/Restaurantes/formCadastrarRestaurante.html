#{extends 'main.html' /}
#{set title:'Gerenciamento de Restaurantes' /}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Restaurantes</title>
</head>
<body class="list-page">
    <header class="header list-header">
        <h1>Gerenciamento de Restaurantes</h1>
        <p class="slogan">Adicione, edite e organize seus restaurantes e seus respectivos clientes.</p>
    </header>

    <div class="separator list-separator"></div>

    <main class="list-main">
        <div class="form-card">
            <h2>#{if R?.id}Editar Restaurante#{/if}#{else}Novo Restaurante#{/else}</h2>

            #{ifErrors}
                <div class="alert alert-danger" style="color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: left;">
                    <p>Por favor, corrija os erros abaixo:</p>
                    <ul>
                    #{errors}
                        <li>${error}</li>
                    #{/errors}
                    </ul>
                </div>
            #{/ifErrors}
            #{form @Restaurantes.salvar(), enctype:'multipart/form-data'}
                <input type="hidden" name="rest.id" value="${R?.id}">

                #{field 'rest.nomeDoRestaurante'}
                    <div class="form-group ${field.hasErrors ? 'hasError' : ''}">
                        <label for="${field.id}">Nome do Restaurante:</label>
                
                        <input type="text" id="${field.id}" name="${field.name}" value="${field.value ?: R?.nomeDoRestaurante}" placeholder="Ex: Sabor da Casa">
                        #{error field.name /}
                    </div>
                #{/field}

                #{field 'rest.CNPJ'}
                    <div class="form-group ${field.hasErrors ? 'hasError' : ''}">
                        <label for="${field.id}">CNPJ:</label>
                        
                        <input type="text" id="${field.id}" name="${field.name}" value="${field.value ?: R?.CNPJ}" placeholder="Ex: 00.000.000/0000-00">
                        #{error field.name /}
                    </div>
                #{/field}

                #{field 'rest.categoria'}
                    <div class="form-group ${field.hasErrors ? 'hasError' : ''}">
                        <label for="${field.id}">Categoria:</label>
                        
                        <input type="text" id="${field.id}" name="${field.name}" value="${field.value ?: R?.categoria}" placeholder="Ex: Brasileira, Italiana, Japonesa">
                        #{error field.name /}
                    </div>
                #{/field}

                #{field 'imagem'}
                    <div class="form-group ${field.hasErrors ? 'hasError' : ''}">
                        <label for="${field.id}">Imagem do Restaurante:</label>
                        <input type="file" id="${field.id}" name="${field.name}">
                        #{error field.name /}
                    </div>
                #{/field}

                #{if R?.id}
                    <hr class="form-separator">
                    <h3>Vincular Cliente (Adicionar Novo)</h3>
                    #{field 'idCliente'}
                        <div class="form-group ${field.hasErrors ? 'hasError' : ''}">
                            <label for="${field.id}">Clientes Disponíveis:</label>
                            <select id="${field.id}" name="${field.name}" class="form-select">
                                <option value="">Selecione para vincular...</option>
                                #{list items: clientes, as:'clie'}
                                    <option value="${clie.id}">${clie.nome}</option>
                                #{/list}
                            </select>
                            #{error field.name /}
                        </div>
                        <input type="submit" value="Vincular Cliente" class="action-btn">
                    #{/field}
                #{/if}

                <button type="submit" name="acaoPrincipal" value="salvar">
                    #{if R?.id}Salvar Alterações#{/if}#{else}Cadastrar Restaurante#{/else}
                </button>
            #{/form}

            #{if R?.id}
                <hr class="form-separator">
                <div class="client-list">
                    <h3>Clientes Vinculados</h3>
                    <div id="clientListContainer">
                        #{if R?.clientes?.isEmpty()}
                            <p>Nenhum cliente vinculado.</p>
                        #{/if}
                        #{else}
                            #{list items: R.clientes, as:'listac'}
                                <div class="client-item">
                                    <span>${listac.nome}</span>
                                    <a href="@{Restaurantes.removerCliente(R.id, listac.id )}" class="remove-btn" onclick="return confirm('Tem certeza que deseja desvincular este cliente?');">remover</a>
                                </div>
                            #{/list}
                        #{/else}
                    </div>
                </div>
            #{/if}

            <div class="navigation-buttons">
                #{if R?.id}
                    <a href="@{Restaurantes.formCadastrarRestaurante()}" class="action-btn">Cadastrar Novo</a>
                #{/if}
                <a href="@{Restaurantes.listar2(null)}" class="action-btn">Voltar para Lista</a>
            </div>
        </div>
    </main>
</body>
</html>