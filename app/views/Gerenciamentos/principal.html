#{extends 'main.html' /}
#{set title:'Lista de Restaurantes' /}

<main>
    <header class="header-content"> 
        <h1>Os Melhores Sabores da Cidade</h1>
        <p class="slogan">Descubra restaurantes por categoria e encontre o seu próximo prato favorito.</p>
    </header>

    <div class="separator"></div>
    
    <div class="categoria-restaurantes">
        <h2><i class="fas fa-store"></i> Todos os Restaurantes</h2>
        <div class="lista-de-cards">
            
            #{list items:restaurantes, as:'rest'}
            <div class="restaurante-card">
                
                <div class="foto-container">
                    #{if rest.imagem?.exists()}
                        <img src="@{Restaurantes.getImagem(id:rest.id)}" alt="${rest.nomeDoRestaurante}">
                    #{/if}
                    #{else}
                        <img src="https://via.placeholder.com/400x160/A34E2B/FFFFFF?text=${rest.nomeDoRestaurante?.replaceAll(' ', '+') ?: 'Restaurante'}" alt="${rest.nomeDoRestaurante}">
                    #{/else}
                </div>
                
                <div class="info-e-acoes">
                    <h3 class="nome-restaurante">${rest.nomeDoRestaurante}</h3>
                    <span class="categoria"><i class="fas fa-tag"></i> ${rest.categoria}</span>
                    
                    <div class="botoes-acao">
                        <a href="#" class="btn-acessar">Acessar</a> 
                        
                        %{
                            // Lógica para verificar se o restaurante já está favoritado
                            isFavorito = clienteConectado != null && clienteConectado.restaurantes.contains(rest);
                        }%

                        #{if clienteConectado}
                            <a href="@{Favoritos.alternarFavorito(rest.id)}" 
                               class="btn-favoritar ${isFavorito ? 'favorito' : ''}" 
                               title="${isFavorito ? 'Remover dos Favoritos' : 'Adicionar aos Favoritos'}">
                                
                                <i class="${isFavorito ? 'fas fa-star' : 'far fa-star'}"></i> 
                            </a>
                        #{/if}
                        #{else}
                            <button class="btn-favoritar" title="Faça login para favoritar" disabled>
                                <i class="far fa-star"></i>
                            </button>
                        #{/else}
                        </div> </div> </div> #{/list}
            
            #{if restaurantes.isEmpty()}
                <p>Nenhum restaurante ativo encontrado.</p>
            #{/if}
            
        </div>
    </div>

    <div class="card-cadastro">
        <p>Seu restaurante não está aqui? Cadastre-se agora!</p>
        <a href="@{restaurantes.formCadastrarRestaurante}" class="btn-cadastrar-restaurante">Cadastrar Meu Restaurante</a>
    </div>

</main>

    
    <script>
        function toggleUserDropdown(e) {
            e.preventDefault(); 
            const userContainer = e.currentTarget.closest('.user-container');
            userContainer.classList.toggle('active');
            e.stopPropagation(); 
        }

        window.addEventListener('click', function(e){
            const userContainer = document.getElementById('userContainer');
            if(userContainer && !userContainer.contains(e.target)){
                userContainer.classList.remove('active');
            }
        });
    </script>
</body>